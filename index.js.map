{"version":3,"file":"index.js","sources":["../src/js/render-functions.js","../src/js/pixabay-api.js","../src/main.js"],"sourcesContent":["\nconst galleryList = document.querySelector(\".gallery\");\nconst hiddenClass = \"is-hidden\";\n\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\n\n\nclass ButtonService {\n  constructor(buttonEl, hiddenClass) {\n    this.buttonEl = buttonEl;\n    this.hiddenClass = hiddenClass;\n  }\n\n  showLoadMoreButton() {\n    this.buttonEl.classList.remove(this.hiddenClass);\n  }\n\n  hideLoadMoreButton() {\n    this.buttonEl.classList.add(this.hiddenClass);\n  }\n}\n\nclass LoadService {\n  constructor(loader, hiddenClass) {\n    this.loader = loader;\n    this.hiddenClass = hiddenClass;\n  }\n\n  showLoader() {\n    this.loader.classList.remove(this.hiddenClass);\n  }\n\n  hideLoader() {\n    this.loader.classList.add(this.hiddenClass);\n  }\n}\n\n// --- Инициализация SimpleLightbox ---\nlet galleryInstance = null;\nfunction ensureLightbox() {\n  if(!galleryInstance) {\n    galleryInstance = new SimpleLightbox('.gallery a', {\n  captions: true,\n  captionDelay: 250,\n});\n  } else {\n        galleryInstance.refresh();\n  }\n}\n\nfunction createGallery(images) {\n  const markup = images\n      .map(\n        ({ webformatURL, largeImageURL, tags, likes, views, comments, downloads }) =>\n            `<li class=\"gallery-item\">\n          <a class=\"gallery-link\" href=\"${largeImageURL}\">\n            <img \n              class=\"gallery-image\" \n              src=\"${webformatURL}\" \n              alt=\"${tags}\" \n            />\n          </a>\n          \n          <ul class=\"image-description\">\n          <li class=\"image-description-item\">Likes <span class=\"description-numbers\">${likes}</span></li>\n          <li class=\"image-description-item\">Views <span class=\"description-numbers\">${views}</span></li>\n          <li class=\"image-description-item\">Comments <span class=\"description-numbers\">${comments}</span></li>\n          <li class=\"image-description-item\">Download <span class=\"description-numbers\">${downloads}</span></li>\n          </ul>\n        </li>`\n      )\n    .join('');\n\n  galleryList.insertAdjacentHTML('beforeend', markup);\n    queueMicrotask(ensureLightbox);\n\n}\n\nfunction clearGallery() {\n  galleryList.innerHTML = '';\n    if (galleryInstance) {\n    galleryInstance.destroy();\n    galleryInstance = null;\n    }\n}\n\nexport { ButtonService, LoadService, createGallery, clearGallery };","import axios from 'axios';\n\nconst BASE_URL = \"https://pixabay.com/api\";\nconst API_KEY = \"52901164-552010a54c9c54893e8a3cd4c\";\n\naxios.defaults.baseURL = BASE_URL;\n\nasync function getImagesByQuery({ page = 1, per_page = 20, q = \"\" } = {}) {\n    try {\n        const response = await axios.get(\"/\", {\n        params: {\n        page,\n        per_page,\n        q,\n        key: API_KEY,\n        image_type: \"photo\",\n        orientation: \"horizontal\",\n        safesearch: true,\n         },\n    }); \n    return response.data;\n    } catch(error) {\n            console.error(\"Error fetching images:\", error);\n            throw error;\n    }\n}\n  \nexport default getImagesByQuery;","\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport * as RenderFunctions from \"./js/render-functions.js\";\nimport getImagesByQuery from \"./js/pixabay-api.js\"\n\nconst form = document.querySelector(\".form\");\nconst galleryList = document.querySelector(\".gallery\");\nconst loader = document.querySelector(\".loader\");\nconst buttonEl = document.querySelector('[data-action=\"load-more\"]');\n\n\nconst params = {\n    page: 1, \n    per_page: 15,\n    q: \"\",\n    maxPage: 0,\n};\n\nconst loadMoreBtn = new RenderFunctions.ButtonService(buttonEl, \"is-hidden\");\nloadMoreBtn.hideLoadMoreButton();\n\nconst loaderMore = new RenderFunctions.LoadService(loader, \"is-hidden\");\nloaderMore.hideLoader();\n\n\n\nfunction getGalleryImageHeight() {\n  const firstImage = document.querySelector('.gallery-image');\n  if (!firstImage) return 0;\n  const { height } = firstImage.getBoundingClientRect();\n  return height;\n}\n\nasync function smoothScrollByImageHeight(multiplier = 2) {\n\n    await new Promise(resolve => requestAnimationFrame(resolve));\n\n  const imgHeight = getGalleryImageHeight();\n  if (imgHeight > 0) {\n    window.scrollBy({\n      top: imgHeight * multiplier,\n      behavior: 'smooth',\n    });\n  }\n}\n\n// --- Слушатель формы ---\nform.addEventListener(\"submit\", handleSearch);\nbuttonEl.addEventListener(\"click\", handleLoadMore);\n\nlet isLoading = false;\n\nasync function handleSearch(event) {\nevent.preventDefault();\n\nRenderFunctions.clearGallery();\n\nconst form = event.currentTarget;\nparams.q = form.elements.search.value.trim();\n\n  // важный сброс пагинации при новом запросе\n  params.page = 1;\n  params.maxPage = 1;\n\nif (!params.q) {\n    iziToast.error({\n      title: 'Error',\n      message: 'Write a request',\n      position: 'topRight',\n    });\n    form.reset();\n    return;\n}\n\nisLoading = true;\nloaderMore.showLoader();\nloadMoreBtn.hideLoadMoreButton();\n\n    try {\nconst { hits, total } = await getImagesByQuery(params);\n\nparams.maxPage = Math.ceil( total / params.per_page);\nconsole.log(total);\nconsole.log(params.maxPage, \"params.maxPage\")\nconsole.log(params.page, \"params.page\")\n\nif (hits.length === 0) {\n    loaderMore.hideLoader();\n      loadMoreBtn.hideLoadMoreButton();\n    iziToast.error({\n         title: 'Error',\n        message: 'Sorry, there are no images matching your search query. Please try again!',\n        position: 'topRight', \n      });\n      return; // прерываем выполнение\n}\n\nRenderFunctions.createGallery(hits);\n// плавна прокрутка вниз на дві висоти картинки\nawait smoothScrollByImageHeight();\n\nloaderMore.hideLoader(); \n\nif(params.maxPage > 1) {\n    loadMoreBtn.showLoadMoreButton();\n\n} else {\n        loadMoreBtn.hideLoadMoreButton();\n      iziToast.info({\n      title: 'End',\n      message: 'You have reached the end of the results.',\n      position: 'topRight',\n    });\n}\n\n}\ncatch (err) {\n    iziToast.error({\n      title: 'Error',\n      message: `There is a problem during query ${err}`,\n      position: 'topRight',\n    });\n} finally {\n  loaderMore.hideLoader();\n  form.reset();\n  isLoading = false;\n}\n}\n\nasync function handleLoadMore() {\n    if (isLoading) return;\n\n    params.page = Number(params.page) || 1; \n    params.maxPage = Number(params.maxPage) || 1;\n\n    if (params.page >= params.maxPage) {\n    iziToast.info({\n      title: 'End',\n      message: 'You have reached the end of the results.',\n      position: 'topRight',\n    });\n    loadMoreBtn.hideLoadMoreButton();\n    return;\n  }\n\n  const nextPage = params.page + 1;\n  isLoading = true;\n  loaderMore.showLoader();\n  loadMoreBtn.hideLoadMoreButton();\n\n    try {\nconst { hits } = await getImagesByQuery({ ...params, page: nextPage });\n\n    params.page = nextPage;\n\nRenderFunctions.createGallery(hits);\n// плавна прокрутка вниз на дві висоти картинки\nawait smoothScrollByImageHeight();\n\n\n    }\n    catch(err) {\n      iziToast.error({\n      title: \"Error\",\n      message: `There is a problem during query ${err}`,\n      position: \"topRight\",\n    }); \n    } finally  {\n        loaderMore.hideLoader();\n        isLoading = false;\n        if(params.page < params.maxPage) {\n          loadMoreBtn.showLoadMoreButton();\n        } else {\n          loadMoreBtn.hideLoadMoreButton();\n        iziToast.info({\n        title: 'End',\n        message: 'You have reached the end of the results.',\n        position: 'topRight',\n      });\n        }\n    }\n} \n\n\n\n\n\n"],"names":["galleryList","ButtonService","buttonEl","hiddenClass","LoadService","loader","galleryInstance","ensureLightbox","SimpleLightbox","createGallery","images","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","clearGallery","BASE_URL","API_KEY","axios","getImagesByQuery","page","per_page","q","error","form","params","loadMoreBtn","RenderFunctions.ButtonService","loaderMore","RenderFunctions.LoadService","getGalleryImageHeight","firstImage","height","smoothScrollByImageHeight","multiplier","resolve","imgHeight","handleSearch","handleLoadMore","isLoading","event","RenderFunctions.clearGallery","iziToast","hits","total","RenderFunctions.createGallery","err","nextPage"],"mappings":"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"}